---
id: S-30
status: complete
step: complete
milestone: parallel-state
started: 2026-02-22
updated: 2026-02-22
tests: 42
security_tests: 0
session:
deps: S-28,S-29
---

# S-30: Slice Command State Write

## Why
The core `/gl:slice` command is the primary writer of slice state and the main source of the concurrent write bug. It must be updated to write only to its own slice file, claim the slice with advisory session tracking, and regenerate STATE.md after writes.

## What
Update `/gl:slice` to read from and write to individual slice files. Add advisory session tracking (ISO timestamp + random suffix) on slice claim. Regenerate STATE.md after every write. Preserve legacy STATE.md behaviour for non-migrated projects.

## Dependencies
- S-28: Slice State Foundation Documents (schema and format rules)
- S-29: Init Command and State Detection (slices/ directory must exist, detection logic must be defined)

## Contracts
- C-81: SliceCommandStateWrite
- C-82: SliceSessionTracking

## Decisions
- 2026-02-22: New section inserted between Pre-flight and Checkpoint in slice.md — preserves pipeline ordering invariants
- 2026-02-22: Advisory session tracking uses ISO timestamp + 4-char hex suffix (no PID/username per security contract)

## Files
- src/commands/gl/slice.md (modified — +91 lines)
- internal/installer/slice_command_state_test.go (new — 503 lines, 42 tests)
