---
id: S-36
status: complete
step: complete
milestone: cli-orchestrator
started: 2026-02-23
updated: 2026-02-23T00:00:00Z
tests: 41
security_tests: 0
session:
deps: S-35
---

# S-36: State Reader

## Why
All CLI commands that display project state need to read slice files and the dependency graph. This is the shared state reading layer.

## What
Read all slice frontmatter into structs, read GRAPH.json dependency data, compute which slices are ready (pending + all deps complete), and detect shell vs Claude execution context via $CLAUDE_CODE env var.

## Dependencies
S-35 (Frontmatter Parser)

## Contracts
- C-93: StateReadSlices
- C-94: StateReadGraph
- C-95: StateFindReadySlices
- C-96: StateDetectContext

## Decisions
- os.ReadDir + os.ReadFile for filesystem access (stdlib only)
- json.RawMessage intermediate struct to detect missing "slices" field
- Status lookup map for O(1) dependency checking
- Slices not in graph treated as having no dependencies

## Files
- internal/state/state.go (new)
- internal/state/state_test.go (new)
