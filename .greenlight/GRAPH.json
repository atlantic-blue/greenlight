{
  "project": "greenlight",
  "description": "Dependency graph for Greenlight CLI stabilisation, brownfield MVP, and documentation system. Defines build order by slice with explicit dependencies and parallelism.",
  "date": "2026-02-09",

  "slices": {
    "S-01": {
      "name": "Version",
      "description": "Show version information. Simplest slice — proves test infrastructure works.",
      "packages": ["internal/version", "internal/cmd/version.go"],
      "contracts": ["C-01", "C-11"],
      "depends_on": [],
      "test_files": ["internal/version/version_test.go", "internal/cmd/version_test.go"],
      "wave": 1
    },
    "S-02": {
      "name": "Flag Parsing",
      "description": "Parse --global/--local scope, --on-conflict strategy, and --verify flag. Pure functions with no dependencies.",
      "packages": ["internal/cmd/scope.go"],
      "contracts": ["C-02", "C-03", "C-04"],
      "depends_on": [],
      "test_files": ["internal/cmd/scope_test.go"],
      "wave": 1
    },
    "S-03": {
      "name": "Conflict Handling",
      "description": "Handle CLAUDE.md conflict strategies (keep, replace, append). Operates on temp directories, no dependencies.",
      "packages": ["internal/installer/conflict.go"],
      "contracts": ["C-05", "C-06"],
      "depends_on": [],
      "test_files": ["internal/installer/conflict_test.go"],
      "wave": 1
    },
    "S-04": {
      "name": "Install",
      "description": "Install all manifest files to target directory with CLAUDE.md conflict handling.",
      "packages": ["internal/installer/installer.go", "internal/cmd/install.go"],
      "contracts": ["C-07", "C-08", "C-12"],
      "depends_on": ["S-01", "S-02", "S-03"],
      "test_files": ["internal/installer/installer_test.go", "internal/cmd/install_test.go"],
      "wave": 2
    },
    "S-05": {
      "name": "Check",
      "description": "Verify installed files exist, are non-empty, and optionally match embedded content.",
      "packages": ["internal/installer/installer.go", "internal/cmd/check.go"],
      "contracts": ["C-09", "C-13"],
      "depends_on": ["S-02", "S-04"],
      "test_files": ["internal/installer/installer_test.go", "internal/cmd/check_test.go"],
      "wave": 3
    },
    "S-06": {
      "name": "Uninstall",
      "description": "Remove installed files, conflict artifacts, version file, and empty directories.",
      "packages": ["internal/installer/installer.go", "internal/cmd/uninstall.go"],
      "contracts": ["C-10", "C-14"],
      "depends_on": ["S-02", "S-04"],
      "test_files": ["internal/installer/installer_test.go", "internal/cmd/uninstall_test.go"],
      "wave": 3
    },
    "S-07": {
      "name": "CLI Dispatch",
      "description": "Top-level command dispatcher and entry point. Depends on all command handlers.",
      "packages": ["internal/cli/cli.go", "main.go"],
      "contracts": ["C-15", "C-16"],
      "depends_on": ["S-01", "S-04", "S-05", "S-06"],
      "test_files": ["internal/cli/cli_test.go"],
      "wave": 4
    },

    "S-08": {
      "name": "Codebase Assessment",
      "description": "User can assess an existing codebase for gaps, risks, and untested boundaries. Creates gl-assessor agent and /gl:assess command. Agent reads codebase, maps test coverage, inventories contracts, identifies risks, compares against CLAUDE.md standards, and produces ASSESS.md with priority-tiered wrap recommendations.",
      "deliverables": ["src/agents/gl-assessor.md", "src/commands/gl/assess.md"],
      "contracts": ["C-17", "C-18", "C-19", "C-20"],
      "depends_on": ["S-12"],
      "user_action": "1. User can assess an existing codebase for gaps, risks, and untested boundaries (/gl:assess)",
      "wave": 6,
      "estimated_tests": 10,
      "boundaries": [
        "User -> /gl:assess command",
        "/gl:assess orchestrator -> gl-assessor agent",
        "gl-assessor agent -> Filesystem (ASSESS.md)",
        "/gl:assess orchestrator -> gl-security agent"
      ]
    },
    "S-09": {
      "name": "Boundary Wrapping",
      "description": "User can wrap existing code in contracts and locking tests without rewriting it. Creates gl-wrapper agent and /gl:wrap command. User selects boundary, wrapper reads implementation, extracts contracts, presents for confirmation, writes locking tests, runs security baseline, commits atomically, updates STATE.md.",
      "deliverables": ["src/agents/gl-wrapper.md", "src/commands/gl/wrap.md"],
      "contracts": ["C-21", "C-22", "C-23", "C-24", "C-25", "C-26"],
      "depends_on": ["S-12"],
      "user_action": "2. User can wrap existing code in contracts and locking tests without rewriting it (/gl:wrap)",
      "wave": 6,
      "estimated_tests": 12,
      "boundaries": [
        "User -> /gl:wrap command",
        "/gl:wrap orchestrator -> gl-wrapper agent",
        "gl-wrapper agent -> Filesystem (CONTRACTS.md)",
        "gl-wrapper agent -> Filesystem (tests/locking/)",
        "/gl:wrap orchestrator -> gl-security agent",
        "/gl:wrap orchestrator -> Filesystem (STATE.md)"
      ]
    },
    "S-10": {
      "name": "Brownfield-Aware Command Updates",
      "description": "User can see brownfield progress alongside greenfield slices. Updates /gl:status (Wrapped Boundaries table), /gl:help (BROWNFIELD section, FLOW line), /gl:settings (assessor and wrapper agent display).",
      "deliverables": ["src/commands/gl/status.md (update)", "src/commands/gl/help.md (update)", "src/commands/gl/settings.md (update)"],
      "contracts": ["C-27", "C-28", "C-29"],
      "depends_on": ["S-12"],
      "user_action": "3. User can see brownfield progress alongside greenfield slices (/gl:status update)",
      "wave": 6,
      "estimated_tests": 8,
      "boundaries": [
        "/gl:status command -> User (wrapped boundaries display)",
        "/gl:help command -> User (brownfield section)",
        "/gl:settings command -> User (assessor, wrapper agents)"
      ]
    },
    "S-11": {
      "name": "Locking-to-Integration Transition",
      "description": "User can refactor a wrapped boundary through the normal TDD loop. Updates /gl:slice to handle wraps field: read locking test names, pass to test writer, execute TDD loop, then delete locking tests and remove [WRAPPED] tag. Updates gl-architect for [WRAPPED] contract awareness. Updates gl-test-writer for locking test name context.",
      "deliverables": ["src/commands/gl/slice.md (update)", "src/agents/gl-architect.md (update)", "src/agents/gl-test-writer.md (update)"],
      "contracts": ["C-30", "C-31", "C-32"],
      "depends_on": ["S-09", "S-12"],
      "user_action": "4. User can refactor a wrapped boundary through the normal TDD loop (/gl:slice with wraps field)",
      "wave": 7,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:slice command -> Locking-to-integration transition",
        "gl-architect agent -> CONTRACTS.md ([WRAPPED] awareness)",
        "gl-test-writer agent -> Locking test name context"
      ]
    },
    "S-12": {
      "name": "Infrastructure and Config Updates",
      "description": "Add 4 new file paths to Go CLI Manifest in installer.go. Update config.json template profiles with assessor and wrapper agent entries. Update CLAUDE.md with gl-assessor and gl-wrapper isolation rules and wrapper exception note. This is the foundation slice that all brownfield slices depend on.",
      "deliverables": ["internal/installer/installer.go (manifest update)", "src/templates/config.md (update)", "src/commands/gl/init.md (update)", "src/CLAUDE.md (update)"],
      "contracts": ["C-33", "C-34", "C-35"],
      "depends_on": [],
      "user_action": "Supports all user actions (infrastructure enabling layer)",
      "wave": 5,
      "estimated_tests": 6,
      "boundaries": [
        "Go CLI -> Manifest (4 new file paths)",
        "config.json template -> Profile (assessor, wrapper entries)",
        "CLAUDE.md -> Agent Isolation Rules (new rows)"
      ]
    },

    "S-13": {
      "name": "Documentation Infrastructure and Design Update",
      "description": "Foundation for all documentation features. Updates /gl:design to produce ROADMAP.md (with initial milestone, Mermaid architecture diagram, slice table) and DECISIONS.md (seeded from design decisions). Adds 2 new file paths to Go CLI Manifest (roadmap.md, changelog.md). Updates /gl:help with INSIGHT section and three-views tagline. Updates /gl:status with roadmap/changelog reference line.",
      "deliverables": ["src/commands/gl/design.md (update)", "internal/installer/installer.go (manifest update +2)", "src/commands/gl/help.md (update)", "src/commands/gl/status.md (update)"],
      "contracts": ["C-36", "C-37", "C-38", "C-39", "C-40"],
      "depends_on": ["S-12"],
      "user_action": "5. User can start a project with a product roadmap and decision log from day one (/gl:design produces ROADMAP.md + DECISIONS.md)",
      "wave": 8,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:design orchestrator -> Filesystem (ROADMAP.md)",
        "/gl:design orchestrator -> Filesystem (DECISIONS.md)",
        "Go CLI -> Manifest (2 new file paths)",
        "/gl:help command -> User (INSIGHT section)",
        "/gl:status command -> User (roadmap/changelog reference)"
      ]
    },
    "S-14": {
      "name": "Auto-Summaries and Decision Aggregation",
      "description": "Automated documentation generation after every slice, wrap, and quick task. Updates /gl:slice to spawn a summary Task after verification, aggregate agent decisions into DECISIONS.md, update ROADMAP.md slice status, and check for architecture changes. Updates /gl:wrap to spawn a wrap summary Task and update ROADMAP.md wrap progress. Updates /gl:quick to generate quick summaries and append decisions.",
      "deliverables": ["src/commands/gl/slice.md (update)", "src/commands/gl/wrap.md (update)", "src/commands/gl/quick.md (update)"],
      "contracts": ["C-41", "C-42", "C-43", "C-44", "C-45"],
      "depends_on": ["S-13"],
      "user_action": "6. User can see what was built and why after each slice, wrap, or quick task (auto-generated summaries + decisions)",
      "wave": 9,
      "estimated_tests": 12,
      "boundaries": [
        "/gl:slice orchestrator -> Summary Task -> Filesystem (summaries/)",
        "/gl:wrap orchestrator -> Summary Task -> Filesystem (summaries/)",
        "/gl:quick orchestrator -> Summary Task -> Filesystem (summaries/)",
        "/gl:slice orchestrator -> Filesystem (DECISIONS.md)",
        "Orchestrators (slice/wrap) -> Filesystem (ROADMAP.md)"
      ]
    },
    "S-15": {
      "name": "Roadmap Command",
      "description": "User can view the product roadmap, plan new milestones, and archive completed ones. /gl:roadmap displays ROADMAP.md (read-only). /gl:roadmap milestone spawns gl-designer with milestone scope to plan new slices, appends to GRAPH.json and ROADMAP.md, and logs decisions. /gl:roadmap archive compresses completed milestones.",
      "deliverables": ["src/commands/gl/roadmap.md"],
      "contracts": ["C-46", "C-47", "C-48"],
      "depends_on": ["S-13"],
      "user_action": "7. User can view product roadmap and plan new milestones (/gl:roadmap)",
      "wave": 9,
      "estimated_tests": 8,
      "boundaries": [
        "User -> /gl:roadmap command (display)",
        "User -> /gl:roadmap milestone -> gl-designer (scoped design session)",
        "User -> /gl:roadmap archive -> Filesystem (ROADMAP.md)"
      ]
    },
    "S-16": {
      "name": "Changelog Command",
      "description": "User can see a human-readable changelog of everything that was built. /gl:changelog reads all summary files from .greenlight/summaries/, formats them chronologically, and displays to the user. Supports filtering by milestone name or date. Read-only, no files written.",
      "deliverables": ["src/commands/gl/changelog.md"],
      "contracts": ["C-49", "C-50"],
      "depends_on": ["S-13"],
      "user_action": "8. User can see a human-readable changelog of everything that was built (/gl:changelog)",
      "wave": 9,
      "estimated_tests": 6,
      "boundaries": [
        "User -> /gl:changelog command (display)",
        "/gl:changelog command -> Summary filtering (milestone, date)"
      ]
    },
    "S-17": {
      "name": "Brownfield-Roadmap Integration",
      "description": "Brownfield context flows into design and milestone planning. /gl:design passes ASSESS.md, CONTRACTS.md, and STATE.md to the designer. /gl:roadmap milestone passes ASSESS.md and wrap progress to milestone planning. gl-designer handles brownfield context blocks, risk tiers, [WRAPPED] tags, and milestone_planning session mode.",
      "deliverables": ["src/commands/gl/design.md (update)", "src/commands/gl/roadmap.md (update)", "src/agents/gl-designer.md (update)"],
      "contracts": ["C-51", "C-52", "C-53"],
      "depends_on": ["S-12", "S-15"],
      "user_action": "9. Brownfield context informs design and milestone planning (risk tiers, wrap progress, [WRAPPED] boundaries)",
      "wave": 10,
      "estimated_tests": 20,
      "boundaries": [
        "/gl:design orchestrator -> gl-designer (brownfield context blocks)",
        "/gl:roadmap milestone -> gl-designer (assessment + wrap progress)",
        "gl-designer agent -> Brownfield-aware design (risk tiers, [WRAPPED] tags)"
      ]
    }
  },

  "waves": {
    "1": {
      "description": "Independent foundations — no inter-slice dependencies. All three can be built and tested in parallel.",
      "slices": ["S-01", "S-02", "S-03"],
      "parallel": true,
      "scope": "stabilisation"
    },
    "2": {
      "description": "Install depends on all Wave 1 slices (version for version file, flag parsing for args, conflict handling for CLAUDE.md).",
      "slices": ["S-04"],
      "parallel": false,
      "scope": "stabilisation"
    },
    "3": {
      "description": "Check and Uninstall both depend on Install (need installed files to verify or remove). They are independent of each other and can run in parallel.",
      "slices": ["S-05", "S-06"],
      "parallel": true,
      "scope": "stabilisation"
    },
    "4": {
      "description": "CLI Dispatch depends on all command handlers. Final integration layer.",
      "slices": ["S-07"],
      "parallel": false,
      "scope": "stabilisation"
    },
    "5": {
      "description": "Brownfield infrastructure: manifest update, config profile additions, CLAUDE.md isolation table update. No dependencies on stabilisation beyond it being complete. Foundation for all brownfield slices.",
      "slices": ["S-12"],
      "parallel": false,
      "scope": "brownfield"
    },
    "6": {
      "description": "Core brownfield features: assess, wrap, and command updates. All depend only on S-12 and can be built in parallel.",
      "slices": ["S-08", "S-09", "S-10"],
      "parallel": true,
      "scope": "brownfield"
    },
    "7": {
      "description": "Locking-to-integration transition. Depends on S-09 (wrapping must exist to refactor) and S-12 (infrastructure).",
      "slices": ["S-11"],
      "parallel": false,
      "scope": "brownfield"
    },
    "8": {
      "description": "Documentation infrastructure: /gl:design update (produce ROADMAP.md and DECISIONS.md), manifest +2 (roadmap.md, changelog.md), help INSIGHT section, status reference line. Foundation for all documentation features. Depends on S-12 (brownfield infrastructure must be in place for combined manifest update).",
      "slices": ["S-13"],
      "parallel": false,
      "scope": "documentation"
    },
    "9": {
      "description": "Documentation features: auto-summaries, roadmap command, and changelog command. All depend only on S-13 and can be built in parallel.",
      "slices": ["S-14", "S-15", "S-16"],
      "parallel": true,
      "scope": "documentation"
    },
    "10": {
      "description": "Brownfield-roadmap integration: design and milestone planning receive brownfield context (ASSESS.md, wrap progress, risk tiers). Depends on S-12 (brownfield infrastructure) and S-15 (roadmap command).",
      "slices": ["S-17"],
      "parallel": false,
      "scope": "documentation"
    }
  },

  "edges": [
    { "from": "S-04", "to": "S-01", "reason": "Install writes version file using version.Version, version.GitCommit, version.BuildDate" },
    { "from": "S-04", "to": "S-02", "reason": "RunInstall calls ParseScope, ResolveDir, ParseConflictStrategy" },
    { "from": "S-04", "to": "S-03", "reason": "Install delegates CLAUDE.md writing to handleConflict" },
    { "from": "S-05", "to": "S-02", "reason": "RunCheck calls ParseScope, ResolveDir" },
    { "from": "S-05", "to": "S-04", "reason": "Check verifies files that Install creates; tests need installed state" },
    { "from": "S-06", "to": "S-02", "reason": "RunUninstall calls ParseScope, ResolveDir" },
    { "from": "S-06", "to": "S-04", "reason": "Uninstall removes files that Install creates; tests need installed state" },
    { "from": "S-07", "to": "S-01", "reason": "CLI dispatches to RunVersion" },
    { "from": "S-07", "to": "S-04", "reason": "CLI dispatches to RunInstall" },
    { "from": "S-07", "to": "S-05", "reason": "CLI dispatches to RunCheck" },
    { "from": "S-07", "to": "S-06", "reason": "CLI dispatches to RunUninstall" },
    { "from": "S-08", "to": "S-12", "reason": "Assess needs gl-assessor.md in manifest and assessor agent model in config profiles" },
    { "from": "S-09", "to": "S-12", "reason": "Wrap needs gl-wrapper.md in manifest and wrapper agent model in config profiles" },
    { "from": "S-10", "to": "S-12", "reason": "Command updates reference assessor/wrapper agents that must be in config profiles" },
    { "from": "S-11", "to": "S-09", "reason": "Locking-to-integration transition requires wrapped boundaries to exist (locking tests, [WRAPPED] contracts)" },
    { "from": "S-11", "to": "S-12", "reason": "Slice updates reference [WRAPPED] contracts and locking tests infrastructure" },
    { "from": "S-13", "to": "S-12", "reason": "Documentation infrastructure builds on brownfield infrastructure: manifest update is additive to C-33, help update is additive to C-28, status update is additive to C-27" },
    { "from": "S-14", "to": "S-13", "reason": "Auto-summaries update ROADMAP.md and DECISIONS.md which must be produceable by /gl:design (C-36, C-37)" },
    { "from": "S-15", "to": "S-13", "reason": "Roadmap command reads and modifies ROADMAP.md which must exist (created by C-36 via /gl:design update)" },
    { "from": "S-16", "to": "S-13", "reason": "Changelog command reads summaries/ and needs roadmap.md and changelog.md in manifest (C-38)" },
    { "from": "S-17", "to": "S-12", "reason": "Brownfield-roadmap integration reads ASSESS.md and CONTRACTS.md which are produced by brownfield infrastructure (S-12)" },
    { "from": "S-17", "to": "S-15", "reason": "Roadmap milestone planning context blocks extend the roadmap command established by S-15" }
  ],

  "import_graph": {
    "main": ["internal/cli"],
    "internal/cli": ["internal/cmd"],
    "internal/cmd": ["internal/installer", "internal/version"],
    "internal/installer": ["internal/version"],
    "internal/version": []
  },

  "user_action_mapping": {
    "1_assess": {
      "action": "User can assess an existing codebase for gaps, risks, and untested boundaries (/gl:assess)",
      "slices": ["S-08", "S-12"],
      "primary_slice": "S-08"
    },
    "2_wrap": {
      "action": "User can wrap existing code in contracts and locking tests without rewriting it (/gl:wrap)",
      "slices": ["S-09", "S-12"],
      "primary_slice": "S-09"
    },
    "3_status": {
      "action": "User can see brownfield progress alongside greenfield slices (/gl:status update)",
      "slices": ["S-10", "S-12"],
      "primary_slice": "S-10"
    },
    "4_refactor": {
      "action": "User can refactor a wrapped boundary through the normal TDD loop (/gl:slice with wraps field)",
      "slices": ["S-11", "S-09", "S-12"],
      "primary_slice": "S-11"
    },
    "5_roadmap_init": {
      "action": "User can start a project with a product roadmap and decision log from day one (/gl:design produces ROADMAP.md + DECISIONS.md)",
      "slices": ["S-13", "S-12"],
      "primary_slice": "S-13"
    },
    "6_auto_summaries": {
      "action": "User can see what was built and why after each slice, wrap, or quick task (auto-generated summaries + decisions)",
      "slices": ["S-14", "S-13", "S-12"],
      "primary_slice": "S-14"
    },
    "7_roadmap_milestones": {
      "action": "User can view product roadmap and plan new milestones (/gl:roadmap)",
      "slices": ["S-15", "S-13", "S-12"],
      "primary_slice": "S-15"
    },
    "8_changelog": {
      "action": "User can see a human-readable changelog of everything that was built (/gl:changelog)",
      "slices": ["S-16", "S-13", "S-12"],
      "primary_slice": "S-16"
    },
    "9_brownfield_roadmap": {
      "action": "Brownfield context informs design and milestone planning (risk tiers, wrap progress, [WRAPPED] boundaries)",
      "slices": ["S-17", "S-15", "S-12"],
      "primary_slice": "S-17"
    }
  }
}
