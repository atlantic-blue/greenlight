{
  "project": "greenlight",
  "description": "Dependency graph for Greenlight CLI stabilisation, brownfield MVP, documentation system, circuit breaker module, verification tiers, and parallel state. Defines build order by slice with explicit dependencies and parallelism.",
  "date": "2026-02-22",

  "slices": {
    "S-01": {
      "name": "Version",
      "description": "Show version information. Simplest slice — proves test infrastructure works.",
      "packages": ["internal/version", "internal/cmd/version.go"],
      "contracts": ["C-01", "C-11"],
      "depends_on": [],
      "test_files": ["internal/version/version_test.go", "internal/cmd/version_test.go"],
      "wave": 1
    },
    "S-02": {
      "name": "Flag Parsing",
      "description": "Parse --global/--local scope, --on-conflict strategy, and --verify flag. Pure functions with no dependencies.",
      "packages": ["internal/cmd/scope.go"],
      "contracts": ["C-02", "C-03", "C-04"],
      "depends_on": [],
      "test_files": ["internal/cmd/scope_test.go"],
      "wave": 1
    },
    "S-03": {
      "name": "Conflict Handling",
      "description": "Handle CLAUDE.md conflict strategies (keep, replace, append). Operates on temp directories, no dependencies.",
      "packages": ["internal/installer/conflict.go"],
      "contracts": ["C-05", "C-06"],
      "depends_on": [],
      "test_files": ["internal/installer/conflict_test.go"],
      "wave": 1
    },
    "S-04": {
      "name": "Install",
      "description": "Install all manifest files to target directory with CLAUDE.md conflict handling.",
      "packages": ["internal/installer/installer.go", "internal/cmd/install.go"],
      "contracts": ["C-07", "C-08", "C-12"],
      "depends_on": ["S-01", "S-02", "S-03"],
      "test_files": ["internal/installer/installer_test.go", "internal/cmd/install_test.go"],
      "wave": 2
    },
    "S-05": {
      "name": "Check",
      "description": "Verify installed files exist, are non-empty, and optionally match embedded content.",
      "packages": ["internal/installer/installer.go", "internal/cmd/check.go"],
      "contracts": ["C-09", "C-13"],
      "depends_on": ["S-02", "S-04"],
      "test_files": ["internal/installer/installer_test.go", "internal/cmd/check_test.go"],
      "wave": 3
    },
    "S-06": {
      "name": "Uninstall",
      "description": "Remove installed files, conflict artifacts, version file, and empty directories.",
      "packages": ["internal/installer/installer.go", "internal/cmd/uninstall.go"],
      "contracts": ["C-10", "C-14"],
      "depends_on": ["S-02", "S-04"],
      "test_files": ["internal/installer/installer_test.go", "internal/cmd/uninstall_test.go"],
      "wave": 3
    },
    "S-07": {
      "name": "CLI Dispatch",
      "description": "Top-level command dispatcher and entry point. Depends on all command handlers.",
      "packages": ["internal/cli/cli.go", "main.go"],
      "contracts": ["C-15", "C-16"],
      "depends_on": ["S-01", "S-04", "S-05", "S-06"],
      "test_files": ["internal/cli/cli_test.go"],
      "wave": 4
    },

    "S-08": {
      "name": "Codebase Assessment",
      "description": "User can assess an existing codebase for gaps, risks, and untested boundaries. Creates gl-assessor agent and /gl:assess command. Agent reads codebase, maps test coverage, inventories contracts, identifies risks, compares against CLAUDE.md standards, and produces ASSESS.md with priority-tiered wrap recommendations.",
      "deliverables": ["src/agents/gl-assessor.md", "src/commands/gl/assess.md"],
      "contracts": ["C-17", "C-18", "C-19", "C-20"],
      "depends_on": ["S-12"],
      "user_action": "1. User can assess an existing codebase for gaps, risks, and untested boundaries (/gl:assess)",
      "wave": 6,
      "estimated_tests": 10,
      "boundaries": [
        "User -> /gl:assess command",
        "/gl:assess orchestrator -> gl-assessor agent",
        "gl-assessor agent -> Filesystem (ASSESS.md)",
        "/gl:assess orchestrator -> gl-security agent"
      ]
    },
    "S-09": {
      "name": "Boundary Wrapping",
      "description": "User can wrap existing code in contracts and locking tests without rewriting it. Creates gl-wrapper agent and /gl:wrap command. User selects boundary, wrapper reads implementation, extracts contracts, presents for confirmation, writes locking tests, runs security baseline, commits atomically, updates STATE.md.",
      "deliverables": ["src/agents/gl-wrapper.md", "src/commands/gl/wrap.md"],
      "contracts": ["C-21", "C-22", "C-23", "C-24", "C-25", "C-26"],
      "depends_on": ["S-12"],
      "user_action": "2. User can wrap existing code in contracts and locking tests without rewriting it (/gl:wrap)",
      "wave": 6,
      "estimated_tests": 12,
      "boundaries": [
        "User -> /gl:wrap command",
        "/gl:wrap orchestrator -> gl-wrapper agent",
        "gl-wrapper agent -> Filesystem (CONTRACTS.md)",
        "gl-wrapper agent -> Filesystem (tests/locking/)",
        "/gl:wrap orchestrator -> gl-security agent",
        "/gl:wrap orchestrator -> Filesystem (STATE.md)"
      ]
    },
    "S-10": {
      "name": "Brownfield-Aware Command Updates",
      "description": "User can see brownfield progress alongside greenfield slices. Updates /gl:status (Wrapped Boundaries table), /gl:help (BROWNFIELD section, FLOW line), /gl:settings (assessor and wrapper agent display).",
      "deliverables": ["src/commands/gl/status.md (update)", "src/commands/gl/help.md (update)", "src/commands/gl/settings.md (update)"],
      "contracts": ["C-27", "C-28", "C-29"],
      "depends_on": ["S-12"],
      "user_action": "3. User can see brownfield progress alongside greenfield slices (/gl:status update)",
      "wave": 6,
      "estimated_tests": 8,
      "boundaries": [
        "/gl:status command -> User (wrapped boundaries display)",
        "/gl:help command -> User (brownfield section)",
        "/gl:settings command -> User (assessor, wrapper agents)"
      ]
    },
    "S-11": {
      "name": "Locking-to-Integration Transition",
      "description": "User can refactor a wrapped boundary through the normal TDD loop. Updates /gl:slice to handle wraps field: read locking test names, pass to test writer, execute TDD loop, then delete locking tests and remove [WRAPPED] tag. Updates gl-architect for [WRAPPED] contract awareness. Updates gl-test-writer for locking test name context.",
      "deliverables": ["src/commands/gl/slice.md (update)", "src/agents/gl-architect.md (update)", "src/agents/gl-test-writer.md (update)"],
      "contracts": ["C-30", "C-31", "C-32"],
      "depends_on": ["S-09", "S-12"],
      "user_action": "4. User can refactor a wrapped boundary through the normal TDD loop (/gl:slice with wraps field)",
      "wave": 7,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:slice command -> Locking-to-integration transition",
        "gl-architect agent -> CONTRACTS.md ([WRAPPED] awareness)",
        "gl-test-writer agent -> Locking test name context"
      ]
    },
    "S-12": {
      "name": "Infrastructure and Config Updates",
      "description": "Add 4 new file paths to Go CLI Manifest in installer.go. Update config.json template profiles with assessor and wrapper agent entries. Update CLAUDE.md with gl-assessor and gl-wrapper isolation rules and wrapper exception note. This is the foundation slice that all brownfield slices depend on.",
      "deliverables": ["internal/installer/installer.go (manifest update)", "src/templates/config.md (update)", "src/commands/gl/init.md (update)", "src/CLAUDE.md (update)"],
      "contracts": ["C-33", "C-34", "C-35"],
      "depends_on": [],
      "user_action": "Supports all user actions (infrastructure enabling layer)",
      "wave": 5,
      "estimated_tests": 6,
      "boundaries": [
        "Go CLI -> Manifest (4 new file paths)",
        "config.json template -> Profile (assessor, wrapper entries)",
        "CLAUDE.md -> Agent Isolation Rules (new rows)"
      ]
    },

    "S-13": {
      "name": "Documentation Infrastructure and Design Update",
      "description": "Foundation for all documentation features. Updates /gl:design to produce ROADMAP.md (with initial milestone, Mermaid architecture diagram, slice table) and DECISIONS.md (seeded from design decisions). Adds 2 new file paths to Go CLI Manifest (roadmap.md, changelog.md). Updates /gl:help with INSIGHT section and three-views tagline. Updates /gl:status with roadmap/changelog reference line.",
      "deliverables": ["src/commands/gl/design.md (update)", "internal/installer/installer.go (manifest update +2)", "src/commands/gl/help.md (update)", "src/commands/gl/status.md (update)"],
      "contracts": ["C-36", "C-37", "C-38", "C-39", "C-40"],
      "depends_on": ["S-12"],
      "user_action": "5. User can start a project with a product roadmap and decision log from day one (/gl:design produces ROADMAP.md + DECISIONS.md)",
      "wave": 8,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:design orchestrator -> Filesystem (ROADMAP.md)",
        "/gl:design orchestrator -> Filesystem (DECISIONS.md)",
        "Go CLI -> Manifest (2 new file paths)",
        "/gl:help command -> User (INSIGHT section)",
        "/gl:status command -> User (roadmap/changelog reference)"
      ]
    },
    "S-14": {
      "name": "Auto-Summaries and Decision Aggregation",
      "description": "Automated documentation generation after every slice, wrap, and quick task. Updates /gl:slice to spawn a summary Task after verification, aggregate agent decisions into DECISIONS.md, update ROADMAP.md slice status, and check for architecture changes. Updates /gl:wrap to spawn a wrap summary Task and update ROADMAP.md wrap progress. Updates /gl:quick to generate quick summaries and append decisions.",
      "deliverables": ["src/commands/gl/slice.md (update)", "src/commands/gl/wrap.md (update)", "src/commands/gl/quick.md (update)"],
      "contracts": ["C-41", "C-42", "C-43", "C-44", "C-45"],
      "depends_on": ["S-13"],
      "user_action": "6. User can see what was built and why after each slice, wrap, or quick task (auto-generated summaries + decisions)",
      "wave": 9,
      "estimated_tests": 12,
      "boundaries": [
        "/gl:slice orchestrator -> Summary Task -> Filesystem (summaries/)",
        "/gl:wrap orchestrator -> Summary Task -> Filesystem (summaries/)",
        "/gl:quick orchestrator -> Summary Task -> Filesystem (summaries/)",
        "/gl:slice orchestrator -> Filesystem (DECISIONS.md)",
        "Orchestrators (slice/wrap) -> Filesystem (ROADMAP.md)"
      ]
    },
    "S-15": {
      "name": "Roadmap Command",
      "description": "User can view the product roadmap, plan new milestones, and archive completed ones. /gl:roadmap displays ROADMAP.md (read-only). /gl:roadmap milestone spawns gl-designer with milestone scope to plan new slices, appends to GRAPH.json and ROADMAP.md, and logs decisions. /gl:roadmap archive compresses completed milestones.",
      "deliverables": ["src/commands/gl/roadmap.md"],
      "contracts": ["C-46", "C-47", "C-48"],
      "depends_on": ["S-13"],
      "user_action": "7. User can view product roadmap and plan new milestones (/gl:roadmap)",
      "wave": 9,
      "estimated_tests": 8,
      "boundaries": [
        "User -> /gl:roadmap command (display)",
        "User -> /gl:roadmap milestone -> gl-designer (scoped design session)",
        "User -> /gl:roadmap archive -> Filesystem (ROADMAP.md)"
      ]
    },
    "S-16": {
      "name": "Changelog Command",
      "description": "User can see a human-readable changelog of everything that was built. /gl:changelog reads all summary files from .greenlight/summaries/, formats them chronologically, and displays to the user. Supports filtering by milestone name or date. Read-only, no files written.",
      "deliverables": ["src/commands/gl/changelog.md"],
      "contracts": ["C-49", "C-50"],
      "depends_on": ["S-13"],
      "user_action": "8. User can see a human-readable changelog of everything that was built (/gl:changelog)",
      "wave": 9,
      "estimated_tests": 6,
      "boundaries": [
        "User -> /gl:changelog command (display)",
        "/gl:changelog command -> Summary filtering (milestone, date)"
      ]
    },
    "S-17": {
      "name": "Brownfield-Roadmap Integration",
      "description": "Brownfield context flows into design and milestone planning. /gl:design passes ASSESS.md, CONTRACTS.md, and STATE.md to the designer. /gl:roadmap milestone passes ASSESS.md and wrap progress to milestone planning. gl-designer handles brownfield context blocks, risk tiers, [WRAPPED] tags, and milestone_planning session mode.",
      "deliverables": ["src/commands/gl/design.md (update)", "src/commands/gl/roadmap.md (update)", "src/agents/gl-designer.md (update)"],
      "contracts": ["C-51", "C-52", "C-53"],
      "depends_on": ["S-12", "S-15"],
      "user_action": "9. Brownfield context informs design and milestone planning (risk tiers, wrap progress, [WRAPPED] boundaries)",
      "wave": 10,
      "estimated_tests": 20,
      "boundaries": [
        "/gl:design orchestrator -> gl-designer (brownfield context blocks)",
        "/gl:roadmap milestone -> gl-designer (assessment + wrap progress)",
        "gl-designer agent -> Brownfield-aware design (risk tiers, [WRAPPED] tags)"
      ]
    },

    "S-18": {
      "name": "Circuit Breaker Protocol and Implementer Integration",
      "description": "Core circuit breaker protocol and implementer integration. Creates references/circuit-breaker.md (~180 lines) defining attempt tracking, per-test trip threshold (3), slice-level ceiling (7), structured diagnostic report format, scope lock protocol, and counter reset protocol. Rewrites gl-implementer.md <error_recovery> section (~40 lines) to enforce circuit breaker: attempt tracking, scope check before every file modification, auto-trip at thresholds, structured diagnostic output.",
      "deliverables": ["src/references/circuit-breaker.md", "src/agents/gl-implementer.md (rewrite <error_recovery>)"],
      "contracts": ["C-54", "C-55", "C-56"],
      "depends_on": [],
      "user_action": "1. Implementer stops after 3 failures; 2. User receives structured diagnostic; 3. Implementer justifies out-of-scope modifications",
      "wave": 11,
      "estimated_tests": 8,
      "boundaries": [
        "Reference doc -> All agents (circuit breaker rules)",
        "gl-implementer agent -> Circuit breaker protocol (error recovery rewrite)",
        "gl-implementer agent -> Contract-inferred scope (justify-or-stop)"
      ]
    },
    "S-19": {
      "name": "Slice Checkpoint Tags and Rollback Integration",
      "description": "Integrates lightweight git checkpoint tags and rollback into /gl:slice. Modifies Step 3 to create greenlight/checkpoint/{slice_id} tag before implementation begins. Modifies implementer failure handling to present structured diagnostic and offer rollback + retry with user guidance. Modifies Step 10 to clean up checkpoint tag on success.",
      "deliverables": ["src/commands/gl/slice.md (update)"],
      "contracts": ["C-57", "C-58"],
      "depends_on": ["S-18"],
      "user_action": "5. Implementer rolls back to clean checkpoint state after human provides input",
      "wave": 12,
      "estimated_tests": 8,
      "boundaries": [
        "/gl:slice orchestrator -> Git (lightweight checkpoint tags)",
        "/gl:slice orchestrator -> Rollback on circuit break"
      ]
    },
    "S-20": {
      "name": "Debug Command",
      "description": "Standalone /gl-debug command that forces a structured diagnostic report at any time. Reads STATE.md for current slice, runs test suite, gathers git context, reads contracts, and produces a structured diagnostic report displayed to the user. Read-only: no files written, no state modified. Does not control the pipeline.",
      "deliverables": ["src/commands/gl/debug.md"],
      "contracts": ["C-59"],
      "depends_on": ["S-18"],
      "user_action": "4. User can force a diagnostic at any time with /gl-debug (manual pull cord)",
      "wave": 12,
      "estimated_tests": 6,
      "boundaries": [
        "User -> /gl-debug command (manual diagnostic override)"
      ]
    },
    "S-21": {
      "name": "Circuit Breaker Infrastructure Integration",
      "description": "Ties circuit breaker into Greenlight infrastructure. Adds 5-line Circuit Breaker subsection to src/CLAUDE.md under Code Quality Constraints (hard rule: 3 per-test, 7 per-slice, scope lock, reference to full protocol). Adds 2 new manifest entries to installer.go (commands/gl/debug.md, references/circuit-breaker.md). Updates manifest count in tests from 32 to 34.",
      "deliverables": ["src/CLAUDE.md (update)", "internal/installer/installer.go (manifest update +2)", "internal/installer/manifest_docs_test.go (count update)"],
      "contracts": ["C-60", "C-61"],
      "depends_on": ["S-18", "S-20"],
      "user_action": "Supports all 5 user actions (infrastructure enabling layer)",
      "wave": 13,
      "estimated_tests": 6,
      "boundaries": [
        "CLAUDE.md -> All agents (5-line hard rule)",
        "Go CLI -> Manifest (2 new file paths)"
      ]
    },

    "S-22": {
      "name": "Schema Extension",
      "description": "Add verification, acceptance_criteria, and steps fields to the contract format in gl-architect.md. Update gl-verifier.md to report tier in verification output. This is the foundation -- contracts must support tiers before anything else.",
      "deliverables": ["src/agents/gl-architect.md (update)", "src/agents/gl-verifier.md (update)"],
      "contracts": ["C-62", "C-63"],
      "depends_on": [],
      "user_action": "1. Architect can set a verification tier (auto/verify) on each contract, with verify as the default",
      "milestone": "verification-tiers",
      "wave": 14,
      "estimated_tests": 6,
      "boundaries": [
        "gl-architect.md -> Contract format (verification fields)",
        "gl-verifier.md -> Verification report (tier reporting)"
      ]
    },
    "S-23": {
      "name": "Verification Gate",
      "description": "Add Step 6b to /gl:slice. Read tier from contracts, resolve effective tier (verify > auto, aggregation), present Verify checkpoint, handle approved response. Create references/verification-tiers.md with tier definitions and checkpoint format. Simple gate -- no rejection handling yet.",
      "deliverables": ["src/references/verification-tiers.md", "src/commands/gl/slice.md (update)"],
      "contracts": ["C-64", "C-65", "C-66"],
      "depends_on": ["S-22"],
      "user_action": "2. After tests pass, a slice with verify tier presents acceptance criteria and optional steps -- user must approve before slice completes",
      "milestone": "verification-tiers",
      "wave": 15,
      "estimated_tests": 10,
      "boundaries": [
        "Reference doc -> Orchestrator + agents (verification tier rules)",
        "/gl:slice orchestrator -> Verification tier gate (Step 6b)",
        "/gl:slice orchestrator -> User (acceptance checkpoint)"
      ]
    },
    "S-24": {
      "name": "Rejection Flow",
      "description": "Handle non-approved responses in the verification gate. Present structured classification options. Route to test writer (with behavioral feedback, contract, acceptance criteria) or to user for contract revision. Resume TDD loop after new tests.",
      "deliverables": ["src/commands/gl/slice.md (update)", "src/references/verification-tiers.md (update)"],
      "contracts": ["C-67", "C-68", "C-69"],
      "depends_on": ["S-23"],
      "user_action": "3. When user rejects, feedback routes through the test writer (TDD-correct) to produce new tests that catch the mismatch",
      "milestone": "verification-tiers",
      "wave": 16,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:slice orchestrator -> User (gap classification UX)",
        "/gl:slice orchestrator -> gl-test-writer (rejection feedback)",
        "/gl:slice orchestrator -> User (contract revision route)"
      ]
    },
    "S-25": {
      "name": "Rejection Counter",
      "description": "Track rejections per slice. Increment on each rejection. Escalation at 3 with options: re-scope, pair, skip. Add escalation format to references/verification-tiers.md.",
      "deliverables": ["src/commands/gl/slice.md (update)", "src/references/verification-tiers.md (update)"],
      "contracts": ["C-70", "C-71"],
      "depends_on": ["S-23"],
      "user_action": "4. After 3 rejections on a slice, escalation triggers with options: re-scope, pair, or skip",
      "milestone": "verification-tiers",
      "wave": 16,
      "estimated_tests": 8,
      "boundaries": [
        "/gl:slice orchestrator -> Per-slice rejection tracking",
        "/gl:slice orchestrator -> User (escalation at 3 rejections)"
      ]
    },
    "S-26": {
      "name": "Documentation and Deprecation",
      "description": "Update CLAUDE.md with verification tier rule. Update checkpoint-protocol.md with Acceptance checkpoint type and Visual deprecation. Update verification-patterns.md with cross-reference. Add deprecation note to templates/config.md for visual_checkpoint. Modify Step 9 of /gl:slice to log deprecation warning. Add 1 manifest entry for references/verification-tiers.md.",
      "deliverables": ["src/CLAUDE.md (update)", "src/references/checkpoint-protocol.md (update)", "src/references/verification-patterns.md (update)", "src/templates/config.md (update)", "src/commands/gl/slice.md (update)", "internal/installer/installer.go (manifest update +1)", "internal/installer/manifest_docs_test.go (count update)"],
      "contracts": ["C-72", "C-73", "C-74"],
      "depends_on": ["S-23"],
      "user_action": "5. Slice with auto tier behaves exactly as today -- no regression; Supports all user actions (infrastructure enabling layer)",
      "milestone": "verification-tiers",
      "wave": 17,
      "estimated_tests": 8,
      "boundaries": [
        "CLAUDE.md -> All agents (verification tier hard rule)",
        "checkpoint-protocol.md -> Acceptance checkpoint type",
        "Go CLI -> Manifest (1 new file path)"
      ]
    },
    "S-27": {
      "name": "Architect Integration",
      "description": "Update gl-architect.md to generate acceptance_criteria and steps from requirements. Add guidance for tier selection: auto for pure data/logic/infrastructure, verify for everything else (it is the default anyway). Update output checklist with verification tier checks.",
      "deliverables": ["src/agents/gl-architect.md (update)"],
      "contracts": ["C-75"],
      "depends_on": ["S-22"],
      "user_action": "1. Architect can set a verification tier (auto/verify) on each contract, with verify as the default",
      "milestone": "verification-tiers",
      "wave": 17,
      "estimated_tests": 4,
      "boundaries": [
        "gl-architect.md -> Tier selection guidance and acceptance criteria generation"
      ]
    },

    "S-28": {
      "name": "Slice State Foundation Documents",
      "description": "Create templates/slice-state.md (schema, lifecycle, session tracking, body sections, naming, examples) and references/state-format.md (detection logic, concurrent access patterns, STATE.md regeneration, crash safety, backward compatibility). These are the foundation documents that all other parallel-state changes reference.",
      "deliverables": ["src/templates/slice-state.md", "src/references/state-format.md"],
      "contracts": ["C-76", "C-77"],
      "depends_on": [],
      "user_action": "1. Run multiple /gl:slice sessions in parallel without state corruption (foundation)",
      "milestone": "parallel-state",
      "wave": 18,
      "estimated_tests": 6,
      "boundaries": [
        "Template file -> Agents (slice state schema and lifecycle)",
        "Reference doc -> All commands (state detection, concurrency, backward compat)"
      ]
    },
    "S-29": {
      "name": "Init Command and State Detection",
      "description": "Update /gl:init to create .greenlight/slices/ directory with individual slice files and .greenlight/project-state.json instead of monolithic STATE.md. Implement state format detection logic (directory existence check) that all commands follow. New projects use file-per-slice from day one.",
      "deliverables": ["src/commands/gl/init.md (update)"],
      "contracts": ["C-78", "C-79", "C-80"],
      "depends_on": ["S-28"],
      "user_action": "1. Run multiple /gl:slice sessions in parallel without state corruption (new projects)",
      "milestone": "parallel-state",
      "wave": 19,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:init orchestrator -> Filesystem (slices/ directory + slice files)",
        "/gl:init orchestrator -> Filesystem (project-state.json)",
        "All commands -> State detection logic (format resolution)"
      ]
    },
    "S-30": {
      "name": "Slice Command State Write",
      "description": "Update /gl:slice to read from and write to individual slice files in file-per-slice mode. Add advisory session tracking (ISO timestamp + random suffix) on slice claim. Regenerate STATE.md after every write. Preserve legacy STATE.md behaviour for non-migrated projects.",
      "deliverables": ["src/commands/gl/slice.md (update)"],
      "contracts": ["C-81", "C-82"],
      "depends_on": ["S-28", "S-29"],
      "user_action": "1. Run multiple /gl:slice sessions in parallel without state corruption",
      "milestone": "parallel-state",
      "wave": 20,
      "estimated_tests": 10,
      "boundaries": [
        "/gl:slice orchestrator -> Filesystem (own slice file + STATE.md regeneration)",
        "/gl:slice orchestrator -> Slice file frontmatter (advisory session field)"
      ]
    },
    "S-31": {
      "name": "Supporting Command Updates",
      "description": "Update /gl:status (read all slice files, compute summary), /gl:pause (write to slice file + project-state.json), /gl:resume (read from slice files + project-state.json), /gl:ship (read all slice files for completeness check), /gl:add-slice (create new slice file), /gl:quick (update test counts in slice file). All commands gain state detection and regenerate STATE.md after writes.",
      "deliverables": ["src/commands/gl/status.md (update)", "src/commands/gl/pause.md (update)", "src/commands/gl/resume.md (update)", "src/commands/gl/ship.md (update)", "src/commands/gl/add-slice.md (update)", "src/commands/gl/quick.md (update)"],
      "contracts": ["C-83", "C-84"],
      "depends_on": ["S-28", "S-29"],
      "user_action": "2. See accurate slice status across all concurrent sessions",
      "milestone": "parallel-state",
      "wave": 20,
      "estimated_tests": 12,
      "boundaries": [
        "/gl:status command -> Filesystem (read all slice files, compute summary)",
        "Supporting commands -> State detection + slice file reads/writes"
      ]
    },
    "S-32": {
      "name": "Migration Command",
      "description": "Create /gl:migrate-state command that converts existing STATE.md projects to file-per-slice format. Parses legacy STATE.md, creates .greenlight/slices/ directory with individual slice files, creates project-state.json, backs up STATE.md, generates new STATE.md in generated format. Migration is explicit (D-32), one-way, and all-or-nothing with rollback on failure.",
      "deliverables": ["src/commands/gl/migrate-state.md"],
      "contracts": ["C-85", "C-86"],
      "depends_on": ["S-28"],
      "user_action": "3. Migrate existing projects to the new state format",
      "milestone": "parallel-state",
      "wave": 20,
      "estimated_tests": 10,
      "boundaries": [
        "User -> /gl:migrate-state command (legacy STATE.md to file-per-slice)",
        "/gl:migrate-state -> Filesystem (backup + atomic creation)"
      ]
    },
    "S-33": {
      "name": "Documentation Updates",
      "description": "Update src/CLAUDE.md with state format awareness rule (check slices/ before STATE.md). Update src/templates/state.md to document both formats, generated nature of STATE.md, and migration instructions. Update src/references/checkpoint-protocol.md to reference slice files for state context.",
      "deliverables": ["src/CLAUDE.md (update)", "src/templates/state.md (update)", "src/references/checkpoint-protocol.md (update)"],
      "contracts": ["C-87", "C-88", "C-89"],
      "depends_on": ["S-28"],
      "user_action": "Supports all user actions (documentation enabling layer)",
      "milestone": "parallel-state",
      "wave": 21,
      "estimated_tests": 6,
      "boundaries": [
        "CLAUDE.md -> All agents (state format awareness hard rule)",
        "templates/state.md -> Both formats documented",
        "checkpoint-protocol.md -> Slice file references for state context"
      ]
    },
    "S-34": {
      "name": "Manifest and Integration",
      "description": "Add 3 new entries to Go CLI Manifest in installer.go: commands/gl/migrate-state.md, references/state-format.md, templates/slice-state.md. Manifest grows from 35 to 38 entries. Update manifest count in tests. End-to-end verification that all embedded content is installed correctly.",
      "deliverables": ["internal/installer/installer.go (manifest update +3)", "internal/installer/manifest_docs_test.go (count update)"],
      "contracts": ["C-90"],
      "depends_on": ["S-28", "S-32", "S-33"],
      "user_action": "Supports all user actions (manifest enabling layer)",
      "milestone": "parallel-state",
      "wave": 22,
      "estimated_tests": 6,
      "boundaries": [
        "Go CLI -> Manifest (3 new file paths)"
      ]
    }
  },

  "waves": {
    "1": {
      "description": "Independent foundations — no inter-slice dependencies. All three can be built and tested in parallel.",
      "slices": ["S-01", "S-02", "S-03"],
      "parallel": true,
      "scope": "stabilisation"
    },
    "2": {
      "description": "Install depends on all Wave 1 slices (version for version file, flag parsing for args, conflict handling for CLAUDE.md).",
      "slices": ["S-04"],
      "parallel": false,
      "scope": "stabilisation"
    },
    "3": {
      "description": "Check and Uninstall both depend on Install (need installed files to verify or remove). They are independent of each other and can run in parallel.",
      "slices": ["S-05", "S-06"],
      "parallel": true,
      "scope": "stabilisation"
    },
    "4": {
      "description": "CLI Dispatch depends on all command handlers. Final integration layer.",
      "slices": ["S-07"],
      "parallel": false,
      "scope": "stabilisation"
    },
    "5": {
      "description": "Brownfield infrastructure: manifest update, config profile additions, CLAUDE.md isolation table update. No dependencies on stabilisation beyond it being complete. Foundation for all brownfield slices.",
      "slices": ["S-12"],
      "parallel": false,
      "scope": "brownfield"
    },
    "6": {
      "description": "Core brownfield features: assess, wrap, and command updates. All depend only on S-12 and can be built in parallel.",
      "slices": ["S-08", "S-09", "S-10"],
      "parallel": true,
      "scope": "brownfield"
    },
    "7": {
      "description": "Locking-to-integration transition. Depends on S-09 (wrapping must exist to refactor) and S-12 (infrastructure).",
      "slices": ["S-11"],
      "parallel": false,
      "scope": "brownfield"
    },
    "8": {
      "description": "Documentation infrastructure: /gl:design update (produce ROADMAP.md and DECISIONS.md), manifest +2 (roadmap.md, changelog.md), help INSIGHT section, status reference line. Foundation for all documentation features. Depends on S-12 (brownfield infrastructure must be in place for combined manifest update).",
      "slices": ["S-13"],
      "parallel": false,
      "scope": "documentation"
    },
    "9": {
      "description": "Documentation features: auto-summaries, roadmap command, and changelog command. All depend only on S-13 and can be built in parallel.",
      "slices": ["S-14", "S-15", "S-16"],
      "parallel": true,
      "scope": "documentation"
    },
    "10": {
      "description": "Brownfield-roadmap integration: design and milestone planning receive brownfield context (ASSESS.md, wrap progress, risk tiers). Depends on S-12 (brownfield infrastructure) and S-15 (roadmap command).",
      "slices": ["S-17"],
      "parallel": false,
      "scope": "documentation"
    },
    "11": {
      "description": "Circuit breaker core: reference protocol document and implementer integration. No dependencies on other milestones. Standalone foundation for all circuit breaker features.",
      "slices": ["S-18"],
      "parallel": false,
      "scope": "circuit-breaker"
    },
    "12": {
      "description": "Circuit breaker features: checkpoint/rollback integration into /gl:slice and standalone /gl-debug command. Both depend on S-18 (protocol must exist) and can be built in parallel.",
      "slices": ["S-19", "S-20"],
      "parallel": true,
      "scope": "circuit-breaker"
    },
    "13": {
      "description": "Circuit breaker infrastructure: CLAUDE.md hard rule and manifest entries. Depends on S-18 (protocol must exist) and S-20 (debug command must exist for manifest entry).",
      "slices": ["S-21"],
      "parallel": false,
      "scope": "circuit-breaker"
    },
    "14": {
      "description": "Verification tiers foundation: contract schema extension (verification, acceptance_criteria, steps fields) and verifier tier awareness. No dependencies on other milestones. Standalone foundation for all verification tier features.",
      "slices": ["S-22"],
      "parallel": false,
      "scope": "verification-tiers"
    },
    "15": {
      "description": "Verification gate: references/verification-tiers.md protocol document and Step 6b integration into /gl:slice. Depends on S-22 (contracts must support tier fields before the gate can read them).",
      "slices": ["S-23"],
      "parallel": false,
      "scope": "verification-tiers"
    },
    "16": {
      "description": "Rejection handling: rejection flow (classification, test writer routing, contract revision) and rejection counter (per-slice tracking, escalation at 3). Both depend on S-23 (gate must exist to trigger rejections) and can be built in parallel.",
      "slices": ["S-24", "S-25"],
      "parallel": true,
      "scope": "verification-tiers"
    },
    "17": {
      "description": "Verification tiers infrastructure and architect integration: CLAUDE.md rule, checkpoint protocol update, manifest entry, visual_checkpoint deprecation, and architect tier selection guidance. Depends on S-23 (protocol and gate must exist) for documentation slices, and S-22 for architect integration.",
      "slices": ["S-26", "S-27"],
      "parallel": true,
      "scope": "verification-tiers"
    },
    "18": {
      "description": "Parallel state foundation: slice state template (schema, lifecycle, examples) and state format reference (detection logic, concurrent access, backward compatibility). No dependencies on other milestones. Standalone foundation for all parallel state features.",
      "slices": ["S-28"],
      "parallel": false,
      "scope": "parallel-state"
    },
    "19": {
      "description": "Init command and state detection: update /gl:init to create slices/ directory, individual slice files, and project-state.json. Implement state format detection. Depends on S-28 (foundation documents must define schema and detection rules).",
      "slices": ["S-29"],
      "parallel": false,
      "scope": "parallel-state"
    },
    "20": {
      "description": "Core command updates and migration: /gl:slice reads/writes own slice file with session tracking, supporting commands adapted for both formats, and /gl:migrate-state converts legacy projects. S-30, S-31, and S-32 all depend on S-28+S-29 and can be built in parallel.",
      "slices": ["S-30", "S-31", "S-32"],
      "parallel": true,
      "scope": "parallel-state"
    },
    "21": {
      "description": "Parallel state documentation: CLAUDE.md state format rule, templates/state.md update for both formats, checkpoint-protocol.md slice file references. Depends on S-28 (foundation documents must be defined).",
      "slices": ["S-33"],
      "parallel": false,
      "scope": "parallel-state"
    },
    "22": {
      "description": "Parallel state manifest and integration: add 3 new file paths to Go CLI manifest, update manifest count in tests, end-to-end verification. Depends on S-28 (template and reference files must exist), S-32 (migrate-state command must exist), and S-33 (documentation updates must be applied).",
      "slices": ["S-34"],
      "parallel": false,
      "scope": "parallel-state"
    }
  },

  "edges": [
    { "from": "S-04", "to": "S-01", "reason": "Install writes version file using version.Version, version.GitCommit, version.BuildDate" },
    { "from": "S-04", "to": "S-02", "reason": "RunInstall calls ParseScope, ResolveDir, ParseConflictStrategy" },
    { "from": "S-04", "to": "S-03", "reason": "Install delegates CLAUDE.md writing to handleConflict" },
    { "from": "S-05", "to": "S-02", "reason": "RunCheck calls ParseScope, ResolveDir" },
    { "from": "S-05", "to": "S-04", "reason": "Check verifies files that Install creates; tests need installed state" },
    { "from": "S-06", "to": "S-02", "reason": "RunUninstall calls ParseScope, ResolveDir" },
    { "from": "S-06", "to": "S-04", "reason": "Uninstall removes files that Install creates; tests need installed state" },
    { "from": "S-07", "to": "S-01", "reason": "CLI dispatches to RunVersion" },
    { "from": "S-07", "to": "S-04", "reason": "CLI dispatches to RunInstall" },
    { "from": "S-07", "to": "S-05", "reason": "CLI dispatches to RunCheck" },
    { "from": "S-07", "to": "S-06", "reason": "CLI dispatches to RunUninstall" },
    { "from": "S-08", "to": "S-12", "reason": "Assess needs gl-assessor.md in manifest and assessor agent model in config profiles" },
    { "from": "S-09", "to": "S-12", "reason": "Wrap needs gl-wrapper.md in manifest and wrapper agent model in config profiles" },
    { "from": "S-10", "to": "S-12", "reason": "Command updates reference assessor/wrapper agents that must be in config profiles" },
    { "from": "S-11", "to": "S-09", "reason": "Locking-to-integration transition requires wrapped boundaries to exist (locking tests, [WRAPPED] contracts)" },
    { "from": "S-11", "to": "S-12", "reason": "Slice updates reference [WRAPPED] contracts and locking tests infrastructure" },
    { "from": "S-13", "to": "S-12", "reason": "Documentation infrastructure builds on brownfield infrastructure: manifest update is additive to C-33, help update is additive to C-28, status update is additive to C-27" },
    { "from": "S-14", "to": "S-13", "reason": "Auto-summaries update ROADMAP.md and DECISIONS.md which must be produceable by /gl:design (C-36, C-37)" },
    { "from": "S-15", "to": "S-13", "reason": "Roadmap command reads and modifies ROADMAP.md which must exist (created by C-36 via /gl:design update)" },
    { "from": "S-16", "to": "S-13", "reason": "Changelog command reads summaries/ and needs roadmap.md and changelog.md in manifest (C-38)" },
    { "from": "S-17", "to": "S-12", "reason": "Brownfield-roadmap integration reads ASSESS.md and CONTRACTS.md which are produced by brownfield infrastructure (S-12)" },
    { "from": "S-17", "to": "S-15", "reason": "Roadmap milestone planning context blocks extend the roadmap command established by S-15" },
    { "from": "S-19", "to": "S-18", "reason": "Checkpoint/rollback integration references circuit breaker protocol (C-54) and implementer diagnostic output (C-55)" },
    { "from": "S-20", "to": "S-18", "reason": "Debug command produces structured diagnostic in the format defined by circuit breaker protocol (C-54)" },
    { "from": "S-21", "to": "S-18", "reason": "CLAUDE.md rule references circuit-breaker.md which must exist; manifest entry for references/circuit-breaker.md requires the file" },
    { "from": "S-21", "to": "S-20", "reason": "Manifest entry for commands/gl/debug.md requires the debug command file to exist" },
    { "from": "S-23", "to": "S-22", "reason": "Verification gate reads tier fields from contracts; contracts must support verification/acceptance_criteria/steps fields (C-62) before gate can resolve them" },
    { "from": "S-24", "to": "S-23", "reason": "Rejection flow handles non-approved responses from the verification gate; gate must exist (C-65) to trigger rejections" },
    { "from": "S-25", "to": "S-23", "reason": "Rejection counter tracks rejections from the verification gate; gate must exist (C-65) to produce rejections to count" },
    { "from": "S-26", "to": "S-23", "reason": "Documentation references verification-tiers.md (C-64) which must exist; checkpoint protocol update references Step 6b (C-65); manifest entry requires references/verification-tiers.md file" },
    { "from": "S-27", "to": "S-22", "reason": "Architect tier guidance references the verification fields (C-62) that must be defined in the contract format first" },
    { "from": "S-29", "to": "S-28", "reason": "Init command references slice state schema (C-76) and state format detection rules (C-77) which must be defined in foundation documents" },
    { "from": "S-30", "to": "S-28", "reason": "Slice command references slice file schema (C-76) and state format rules (C-77) for reading/writing slice files" },
    { "from": "S-30", "to": "S-29", "reason": "Slice command uses state detection (C-80) which must be implemented in /gl:init update; needs slices/ directory to exist" },
    { "from": "S-31", "to": "S-28", "reason": "Supporting commands reference state format rules (C-77) for detection and slice file schema (C-76) for parsing" },
    { "from": "S-31", "to": "S-29", "reason": "Supporting commands use state detection (C-80) and require slices/ directory and project-state.json to exist (C-78, C-79)" },
    { "from": "S-32", "to": "S-28", "reason": "Migration command creates slice files following schema (C-76) and follows state format rules (C-77) for the target format" },
    { "from": "S-33", "to": "S-28", "reason": "Documentation references state-format.md (C-77) and slice-state.md (C-76) which must exist before cross-references can be added" },
    { "from": "S-34", "to": "S-28", "reason": "Manifest entries for templates/slice-state.md and references/state-format.md require the files to exist" },
    { "from": "S-34", "to": "S-32", "reason": "Manifest entry for commands/gl/migrate-state.md requires the command file to exist" },
    { "from": "S-34", "to": "S-33", "reason": "Manifest installation must include all documentation updates (CLAUDE.md, state.md, checkpoint-protocol.md) to ensure consistency" }
  ],

  "import_graph": {
    "main": ["internal/cli"],
    "internal/cli": ["internal/cmd"],
    "internal/cmd": ["internal/installer", "internal/version"],
    "internal/installer": ["internal/version"],
    "internal/version": []
  },

  "user_action_mapping": {
    "1_assess": {
      "action": "User can assess an existing codebase for gaps, risks, and untested boundaries (/gl:assess)",
      "slices": ["S-08", "S-12"],
      "primary_slice": "S-08"
    },
    "2_wrap": {
      "action": "User can wrap existing code in contracts and locking tests without rewriting it (/gl:wrap)",
      "slices": ["S-09", "S-12"],
      "primary_slice": "S-09"
    },
    "3_status": {
      "action": "User can see brownfield progress alongside greenfield slices (/gl:status update)",
      "slices": ["S-10", "S-12"],
      "primary_slice": "S-10"
    },
    "4_refactor": {
      "action": "User can refactor a wrapped boundary through the normal TDD loop (/gl:slice with wraps field)",
      "slices": ["S-11", "S-09", "S-12"],
      "primary_slice": "S-11"
    },
    "5_roadmap_init": {
      "action": "User can start a project with a product roadmap and decision log from day one (/gl:design produces ROADMAP.md + DECISIONS.md)",
      "slices": ["S-13", "S-12"],
      "primary_slice": "S-13"
    },
    "6_auto_summaries": {
      "action": "User can see what was built and why after each slice, wrap, or quick task (auto-generated summaries + decisions)",
      "slices": ["S-14", "S-13", "S-12"],
      "primary_slice": "S-14"
    },
    "7_roadmap_milestones": {
      "action": "User can view product roadmap and plan new milestones (/gl:roadmap)",
      "slices": ["S-15", "S-13", "S-12"],
      "primary_slice": "S-15"
    },
    "8_changelog": {
      "action": "User can see a human-readable changelog of everything that was built (/gl:changelog)",
      "slices": ["S-16", "S-13", "S-12"],
      "primary_slice": "S-16"
    },
    "9_brownfield_roadmap": {
      "action": "Brownfield context informs design and milestone planning (risk tiers, wrap progress, [WRAPPED] boundaries)",
      "slices": ["S-17", "S-15", "S-12"],
      "primary_slice": "S-17"
    },
    "10_circuit_breaker_auto_stop": {
      "action": "Implementer automatically stops after 3 failed attempts on a test (instead of looping endlessly)",
      "slices": ["S-18", "S-21"],
      "primary_slice": "S-18"
    },
    "11_circuit_breaker_diagnostic": {
      "action": "User receives a structured diagnostic report when the circuit trips (exact errors, attempts log, hypothesis, specific question)",
      "slices": ["S-18", "S-19"],
      "primary_slice": "S-18"
    },
    "12_scope_lock": {
      "action": "Implementer justifies every out-of-scope file modification before making it (prevents scope creep and phantom fixes)",
      "slices": ["S-18"],
      "primary_slice": "S-18"
    },
    "13_manual_debug": {
      "action": "User can force a diagnostic at any time with /gl-debug (manual pull cord)",
      "slices": ["S-20", "S-21"],
      "primary_slice": "S-20"
    },
    "14_rollback": {
      "action": "Implementer rolls back to clean checkpoint state after human provides input (no debris from failed attempts)",
      "slices": ["S-19"],
      "primary_slice": "S-19"
    },
    "15_verification_tier_setting": {
      "action": "Architect can set a verification tier (auto/verify) on each contract, with verify as the default",
      "slices": ["S-22", "S-27"],
      "primary_slice": "S-22"
    },
    "16_verification_gate": {
      "action": "After tests pass, a slice with verify tier presents acceptance criteria and optional steps -- user must approve before slice completes",
      "slices": ["S-23", "S-26"],
      "primary_slice": "S-23"
    },
    "17_rejection_flow": {
      "action": "When user rejects, feedback routes through the test writer (TDD-correct) to produce new tests that catch the mismatch",
      "slices": ["S-24"],
      "primary_slice": "S-24"
    },
    "18_rejection_escalation": {
      "action": "After 3 rejections on a slice, escalation triggers with options: re-scope, pair, or skip",
      "slices": ["S-25"],
      "primary_slice": "S-25"
    },
    "19_auto_tier_no_regression": {
      "action": "Slice with auto tier behaves exactly as today -- no regression",
      "slices": ["S-23", "S-26"],
      "primary_slice": "S-23"
    },
    "20_parallel_slices": {
      "action": "Run multiple /gl:slice sessions in parallel without state corruption",
      "slices": ["S-28", "S-29", "S-30", "S-31", "S-33", "S-34"],
      "primary_slice": "S-30"
    },
    "21_accurate_status": {
      "action": "See accurate slice status across all concurrent sessions",
      "slices": ["S-28", "S-29", "S-31", "S-33", "S-34"],
      "primary_slice": "S-31"
    },
    "22_migrate_state": {
      "action": "Migrate existing projects to the new state format",
      "slices": ["S-28", "S-32", "S-34"],
      "primary_slice": "S-32"
    }
  }
}
